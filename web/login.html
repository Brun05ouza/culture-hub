<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Entrar – Culture Hub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <link rel="stylesheet" href="/css/global.css">
  <link rel="stylesheet" href="/css/auth.css">
  <link rel="stylesheet" href="/css/improvements.css">
  <script type="module" src="/js/script.js"></script>
  <script src="/js/script.js" defer></script>
</head>

<body class="auth-has-bg" style="background:
         linear-gradient(135deg, rgba(2,6,23,.50), rgba(2,132,199,.30)),
         url('/img/fundo.jpg') center/cover no-repeat;">


  <!-- Conteúdo -->
  <main class="auth-wrapper">
    <section class="auth-card">
      <aside class="auth-aside">
        <span class="kicker">Volte ao que interessa</span>
        <h1>Bem-vindo de volta</h1>
        <p class="lead">Entre para criar e acompanhar seus eventos favoritos. Você também pode continuar como convidado.
        </p>

        <!-- Features com subtítulo -->
        <ul class="feature-list">
          <li class="feature">
            <i data-lucide="check-circle"></i>
            <div>
              <b>Descubra eventos locais</b>
              <span>Achados perto de você, atualizados todo dia.</span>
            </div>
          </li>
          <li class="feature">
            <i data-lucide="check-circle"></i>
            <div>
              <b>Crie e gerencie</b>
              <span>Publique, edite e acompanhe inscrições em tempo real.</span>
            </div>
          </li>
          <li class="feature">
            <i data-lucide="check-circle"></i>
            <div>
              <b>Favoritos & alertas</b>
              <span>Salve artistas e receba lembretes antes do evento.</span>
            </div>
          </li>
        </ul>

        <!-- Métricas rápidas -->
        <div class="metrics">
          <div class="metric"><strong>12k+</strong><span>usuários</span></div>
          <div class="metric"><strong>1.4k</strong><span>eventos/mês</span></div>
          <div class="metric"><strong>4,8★</strong><span>avaliação</span></div>
        </div>

        <!-- Mini destaque -->
        <div class="spotlight-card small">
          <img src="/img/events/arte-bienal.webp" alt="">
          <div class="spotlight-info">
            <span class="badge">Voltando hoje</span>
            <h3>Show no Centro</h3>
            <p>Rio • 20:00</p>
          </div>
        </div>

        <p class="trust-badges" style="margin-top:1rem">
          <i data-lucide="shield-check"></i> Login seguro • Sem spam • Você controla seus dados
        </p>
      </aside>

      <div class="auth-form">
        <h2 class="auth-title">Entrar</h2>

        <form id="loginForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
            <input id="loginEmail" type="email" class="form-input" placeholder="seu@email.com" required>
          </div>
          <div>
            <div class="flex justify-between items-center mb-1">
              <label class="block text-sm font-medium text-gray-700">Senha</label>
              <a id="forgotPassword" href="#" class="text-sm text-blue-600 hover:underline">Esqueci a senha</a>
            </div>
            <div class="relative">
              <input id="loginPassword" type="password" class="form-input pr-12" placeholder="••••••••" required>
              <button type="button" class="pw-toggle" data-target="loginPassword" aria-label="Mostrar/ocultar senha">
                <i data-lucide="eye"></i>
              </button>
            </div>
          </div>

          <div id="loginError" class="auth-error" hidden></div>

          <button type="submit" class="btn btn-primary w-full">Entrar</button>

          <button type="button" id="googleLogin" class="btn btn-secondary w-full btn-google">
            <i data-lucide="chrome" class="g-icon"></i>
            <span>Entrar com Google</span>
            <span class="ghost" aria-hidden="true"></span>
          </button>
          <button type="button" id="guestLogin" class="btn-ghost w-full" onclick="localStorage.setItem('isGuest', 'true'); window.location.href='/telaPrincipal.html';">Continuar como convidado</button>
        </form>

        <p class="auth-alt">Não tem conta?
          <a class="text-blue-600 hover:underline" href="cadastro.html">Cadastre-se</a>
        </p>
      </div>
    </section>
  </main>

  <script>
    // Inicializar ícones Lucide imediatamente
    if (window.lucide) {
      lucide.createIcons();
    } else {
      document.addEventListener('DOMContentLoaded', () => {
        if (window.lucide) lucide.createIcons();
      });
    }
    
    // Configurar Google Sign-In
    function initGoogleSignIn() {
      if (typeof google !== 'undefined' && google.accounts) {
        google.accounts.id.initialize({
          client_id: "898450253699-201vqp5l08n6ee9qniu7nhv3n8ng3o56.apps.googleusercontent.com",
          callback: handleGoogleResponse
        });
      }
    }
    
    function handleGoogleResponse(response) {
      try {
        const payload = JSON.parse(atob(response.credential.split('.')[1]));
        const userData = {
          name: payload.name,
          email: payload.email,
          picture: payload.picture
        };
        localStorage.setItem('user', JSON.stringify(userData));
        window.location.href = "/telaPrincipal.html";
      } catch (error) {
        console.error('Erro no login Google:', error);
        alert('Erro ao fazer login com Google');
      }
    }
    
    // Configurar botão Google
    document.addEventListener('DOMContentLoaded', function() {
      const googleBtn = document.getElementById('googleLogin');
      if (googleBtn) {
        googleBtn.addEventListener('click', function() {
          if (typeof google !== 'undefined' && google.accounts) {
            google.accounts.id.prompt();
          } else {
            alert('Google Sign-In não está disponível');
          }
        });
      }
    });
    
    // Login padrão com validação
    document.getElementById('loginForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      const errorDiv = document.getElementById('loginError');
      const submitBtn = e.target.querySelector('button[type="submit"]');
      
      // Limpar erros anteriores
      errorDiv.hidden = true;
      
      // Validações
      if (!email || !password) {
        showError('Preencha todos os campos');
        return;
      }
      
      if (password.length < 6) {
        showError('A senha deve ter pelo menos 6 caracteres');
        return;
      }
      
      // Loading state
      submitBtn.disabled = true;
      submitBtn.textContent = 'Entrando...';
      
      // Simular delay de login
      setTimeout(() => {
        const userData = {
          name: email.split('@')[0],
          email: email,
          picture: 'https://ui-avatars.com/api/?name=' + encodeURIComponent(email.split('@')[0]) + '&background=3b82f6&color=fff'
        };
        localStorage.setItem('user', JSON.stringify(userData));
        localStorage.removeItem('isGuest');
        window.location.href = '/telaPrincipal.html';
      }, 1000);
      
      function showError(message) {
        errorDiv.textContent = message;
        errorDiv.hidden = false;
        submitBtn.disabled = false;
        submitBtn.textContent = 'Entrar';
      }
    });
    
    // Toggle de senha
    document.addEventListener('DOMContentLoaded', function() {
      const toggleBtn = document.querySelector('.pw-toggle');
      const passwordInput = document.getElementById('loginPassword');
      
      if (toggleBtn && passwordInput) {
        toggleBtn.addEventListener('click', function(e) {
          e.preventDefault();
          const isPassword = passwordInput.type === 'password';
          passwordInput.type = isPassword ? 'text' : 'password';
          
          const icon = toggleBtn.querySelector('i');
          if (icon) {
            icon.setAttribute('data-lucide', isPassword ? 'eye-off' : 'eye');
            if (window.lucide) lucide.createIcons();
          }
        });
      }
    });
    
    // Esqueci minha senha com envio real
    document.addEventListener('DOMContentLoaded', function() {
      const forgotBtn = document.getElementById('forgotPassword');
      if (forgotBtn) {
        forgotBtn.addEventListener('click', async function(e) {
          e.preventDefault();
          const email = document.getElementById('loginEmail').value.trim();
          
          if (!email) {
            alert('Digite seu e-mail primeiro para recuperar a senha');
            document.getElementById('loginEmail').focus();
            return;
          }
          
          // Loading state
          forgotBtn.textContent = 'Enviando...';
          forgotBtn.style.pointerEvents = 'none';
          
          try {
            // Enviar email real usando EmailJS
            await sendPasswordResetEmail(email);
            
            // Modal de sucesso
            const modal = document.createElement('div');
            modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:1000';
            modal.innerHTML = `
              <div style="background:white;padding:2rem;border-radius:8px;max-width:400px;text-align:center">
                <i data-lucide="mail-check" style="width:3rem;height:3rem;color:#10b981;margin:0 auto 1rem"></i>
                <h3 style="margin-bottom:1rem;font-size:1.25rem;font-weight:600">E-mail enviado!</h3>
                <p style="margin-bottom:1.5rem;color:#6b7280">Enviamos um link de recuperação para <strong>${email}</strong></p>
                <p style="margin-bottom:1.5rem;color:#6b7280;font-size:0.875rem">Verifique sua caixa de entrada e spam.</p>
                <button onclick="this.closest('div').parentElement.remove()" style="background:#10b981;color:white;padding:0.5rem 1rem;border:none;border-radius:4px;cursor:pointer">OK</button>
              </div>
            `;
            
            document.body.appendChild(modal);
            if (window.lucide) window.lucide.createIcons();
            
          } catch (error) {
            alert('Erro ao enviar e-mail. Tente novamente.');
          } finally {
            forgotBtn.textContent = 'Esqueci a senha';
            forgotBtn.style.pointerEvents = 'auto';
          }
        });
      }
    });
    
    // Função para enviar email de recuperação
    async function sendPasswordResetEmail(email) {
      const resetToken = Math.random().toString(36).substring(2, 15);
      const resetLink = `${window.location.origin}/reset-password.html?token=${resetToken}&email=${encodeURIComponent(email)}`;
      
      // Usar EmailJS para envio real
      const templateParams = {
        to_email: email,
        reset_link: resetLink,
        user_name: email.split('@')[0]
      };
      
      // Configuração do EmailJS (substitua pelos seus IDs)
      return emailjs.send(
        'service_culturehub', // Service ID
        'template_reset', // Template ID
        templateParams,
        'your_public_key' // Public Key
      );
    }
    
    // Inicializar quando Google carregar
    window.onload = initGoogleSignIn;
  </script>
</body>

</html>